import{u as L}from"./list-6c70d22a.js";import{u as M}from"./settings-31cf87a9.js";import{g as W,o as B,a as V,n as D,u as T,b as j,r as _,w as F,c as k,s as I,d as R,e as q,f as C,V as H,h as S,i as N,t as P,j as O}from"./index-ef10d708.js";import{V as $}from"./VCol-933e52e3.js";import{V as z}from"./VRow-38d521f0.js";function A(e){return W()?(B(e),!0):!1}function w(){const e=new Set,t=o=>{e.delete(o)};return{on:o=>{e.add(o);const i=()=>t(o);return A(i),{off:i}},off:t,trigger:(...o)=>Promise.all(Array.from(e).map(i=>i(...o)))}}function E(e){return typeof e=="function"?e():T(e)}const J=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const K=Object.prototype.toString,Q=e=>K.call(e)==="[object Object]",X=()=>{};function Y(e){return e||j()}function Z(e,t=!0,n){const s=Y(n);s?V(e,s):t?e():D(e)}function ee(e){var t;const n=E(e);return(t=n==null?void 0:n.$el)!=null?t:n}const U=J?window:void 0;function te(...e){let t,n,s,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,s,o]=e,t=U):[t,n,s,o]=e,!t)return X;Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);const i=[],a=()=>{i.forEach(c=>c()),i.length=0},m=(c,r,l,u)=>(c.addEventListener(r,l,u),()=>c.removeEventListener(r,l,u)),g=F(()=>[ee(t),E(o)],([c,r])=>{if(a(),!c)return;const l=Q(r)?{...r}:r;i.push(...n.flatMap(u=>s.map(p=>m(c,u,p,l))))},{immediate:!0,flush:"post"}),v=()=>{g(),a()};return A(v),v}function ne(){const e=_(!1);return j()&&V(()=>{e.value=!0}),e}function oe(e){const t=ne();return k(()=>(t.value,!!e()))}function se(e={}){const{window:t=U,requestPermissions:n=!0}=e,s=e,o=oe(()=>!!t&&"Notification"in t),i=_(o.value&&"permission"in Notification&&Notification.permission==="granted"),a=_(null),m=async()=>{if(o.value)return!i.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(i.value=!0),i.value},{on:g,trigger:v}=w(),{on:c,trigger:r}=w(),{on:l,trigger:u}=w(),{on:p,trigger:x}=w(),y=async d=>{if(!o.value||!i.value)return;const f=Object.assign({},s,d);return a.value=new Notification(f.title||"",f),a.value.onclick=v,a.value.onshow=r,a.value.onerror=u,a.value.onclose=x,a.value},h=()=>{a.value&&a.value.close(),a.value=null};if(n&&Z(m),A(h),o.value&&t){const d=t.document;te(d,"visibilitychange",f=>{f.preventDefault(),d.visibilityState==="visible"&&h()})}return{isSupported:o,notification:a,ensurePermissions:m,permissionGranted:i,show:y,close:h,onClick:g,onShow:c,onError:l,onClose:p}}const ie={class:"text-h3 mt-6 mb-6"},re={class:"text-h2 mt-6 mb-6"},ae={class:"mt-6 mb-6"},me={__name:"HomeView",setup(e){const t=L(),{currentItem:n,items:s,timeleft:o}=I(t),{setCurrentItem:i,countdown:a,setFinishedItem:m}=t,g=M(),{selectedAlarmFile:v,notify:c}=I(g),r={STOP:0,COUNTING:1,PAUSE:2},l=_(r.STOP);let u=0;const p=()=>{l.value===r.STOP&&s.value.length>0&&i(),l.value=r.COUNTING,u=setInterval(()=>{a(),o.value===0&&y()},1e3)},x=()=>{l.value=r.PAUSE,clearInterval(u)},y=()=>{clearInterval(u),l.value=r.STOP;const f=new Audio;if(f.src=v.value,f.play(),c.value){const{show:b,isSupported:G}=se({title:"事項完成",body:n.value,icon:new URL(""+new URL("tomato-fe6b03eb.png",import.meta.url).href,self.location).href});G.value&&b()}m(),s.value.length>0&&p()},h=k(()=>n.value.length>0?n.value:s.value.length>0?"點擊開始":"沒有事項"),d=k(()=>{const f=Math.floor(o.value/60).toString().padStart(2,"0"),b=(o.value%60).toString().padStart(2,"0");return f+":"+b});return(f,b)=>(R(),q(H,{class:"h-100 d-flex justify-center align-center"},{default:C(()=>[S(z,{class:"d-flex justify-center align-center"},{default:C(()=>[S($,{cols:"12",class:"d-flex flex-column justify-center align-center"},{default:C(()=>[N("h1",ie,P(h.value),1),N("h1",re,P(d.value),1),N("div",ae,[S(O,{class:"text-h4",variant:"text",icon:"mdi-play",disabled:l.value===r.COUNTING||T(n).length===0&&T(s).length===0,onClick:p},null,8,["disabled"]),S(O,{class:"text-h4",variant:"text",icon:"mdi-pause",disabled:l.value!==r.COUNTING,onClick:x},null,8,["disabled"]),S(O,{class:"text-h4",variant:"text",icon:"mdi-skip-next",disabled:T(n).length===0,onClick:y},null,8,["disabled"])])]),_:1})]),_:1})]),_:1}))}};export{me as default};
